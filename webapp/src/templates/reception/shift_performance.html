<!doctype html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ğŸ“Š Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø´ÛŒÙØª {{ shift_fa }}</title>
    <link href="{{ url_for('static', filename='css/vazirmatn.css') }}" rel="stylesheet" />
    <style>
        /* ØªÙ… Ù…ÛŒÙ†ÛŒÙ…Ø§Ù„ Ù…Ø¯Ø±Ù† */
        :root {
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #0f172a;
            --text-muted: #64748b;
            --accent: #6366f1;
            --accent-light: #eef2ff;
            --success: #10b981;
            --success-light: #d1fae5;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --border: #e2e8f0;
            --shadow: 0 4px 20px -4px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 40px -10px rgba(0,0,0,0.15);
        }
        body.theme-dark {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --accent: #818cf8;
            --accent-light: #312e81;
            --success-light: #064e3b;
            --warning-light: #78350f;
            --danger-light: #7f1d1d;
            --border: #334155;
            --shadow: 0 4px 20px -4px rgba(0,0,0,0.4);
            --shadow-lg: 0 10px 40px -10px rgba(0,0,0,0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Vazirmatn', Tahoma, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        /* Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .page-title {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--accent);
        }
        .shift-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.9rem;
        }
        .shift-morning { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e; }
        .shift-evening { background: linear-gradient(135deg, #fed7aa, #fdba74); color: #9a3412; }
        .shift-night { background: linear-gradient(135deg, #c7d2fe, #a5b4fc); color: #3730a3; }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.7rem 1.3rem;
            border-radius: 10px;
            border: none;
            font-family: inherit;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        .btn-back { background: var(--card); color: var(--text); border: 1px solid var(--border); }
        .btn-back:hover { background: var(--accent-light); border-color: var(--accent); }
        .btn-print { background: var(--accent); color: white; }
        .btn-print:hover { transform: translateY(-2px); box-shadow: var(--shadow); }

        /* Time Info Card */
        .time-card {
            background: var(--card);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 3rem;
            flex-wrap: wrap;
        }
        .time-item {
            text-align: center;
        }
        .time-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.3rem;
        }
        .time-value {
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            /* Fixed 3 columns for nicer two-row layout (3 up, 3 down) */
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .stats-grid { grid-template-columns: 1fr; }
        }
        .stat-card {
            background: var(--card);
            border-radius: 16px;
            padding: 1.5rem 1.75rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            opacity: 0.1;
            transform: translate(30px, -30px);
        }
        .stat-card.visits::before { background: var(--accent); }
        .stat-card.injections::before { background: var(--success); }
        .stat-card.procedures::before { background: var(--warning); }
        .stat-card.consumables::before { background: #8b5cf6; }
        .stat-card.revenue::before { background: #ec4899; }
        .stat-card.patients::before { background: #0ea5e9; }
        
        .stat-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .stat-card.visits .stat-icon { background: var(--accent-light); }
        .stat-card.injections .stat-icon { background: var(--success-light); }
        .stat-card.procedures .stat-icon { background: var(--warning-light); }
        .stat-card.consumables .stat-icon { background: linear-gradient(135deg, #ede9fe, #ddd6fe); }
        .stat-card.revenue .stat-icon { background: linear-gradient(135deg, #fce7f3, #fbcfe8); }
        .stat-card.patients .stat-icon { background: linear-gradient(135deg, #e0f2fe, #bae6fd); }

        .stat-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-muted);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 900;
            line-height: 1;
            margin-bottom: 0.5rem;
        }
        .stat-card.visits .stat-value { color: var(--accent); }
        .stat-card.injections .stat-value { color: var(--success); }
        .stat-card.procedures .stat-value { color: var(--warning); }
        .stat-card.consumables .stat-value { color: #8b5cf6; }
        .stat-card.revenue .stat-value { color: #ec4899; }
        .stat-card.patients .stat-value { color: #0ea5e9; }

        .stat-sub {
            font-size: 0.85rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .stat-sub strong {
            color: var(--text);
        }

        /* Financial Summary Card */
        .fin-card {
            background: var(--card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            padding: 1.5rem;
        }
        .fin-title {
            font-size: 1.1rem;
            font-weight: 800;
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .fin-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        @media (max-width: 640px) {
            .fin-grid { grid-template-columns: 1fr; }
        }
        .fin-box {
            text-align: center;
            padding: 1.25rem;
            border-radius: 14px;
        }
        .fin-box.total { background: linear-gradient(135deg, #ede9fe, #ddd6fe); }
        .fin-box.paid { background: var(--success-light); }
        .fin-box.pending { background: var(--danger-light); }
        .fin-box-value {
            font-size: 1.75rem;
            font-weight: 900;
            margin-bottom: 0.3rem;
        }
        .fin-box.total .fin-box-value { color: #7c3aed; }
        .fin-box.paid .fin-box-value { color: var(--success); }
        .fin-box.pending .fin-box-value { color: var(--danger); }
        .fin-box-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        /* Sections / Tables */
        .section-card {
            background: var(--card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            padding: 1.25rem;
            margin-bottom: 1.25rem;
        }
        .section-title {
            font-size: 1rem;
            font-weight: 800;
            margin: 0 0 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text);
        }
        .meta-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
            justify-content: space-between;
        }
        .meta-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
        }
        .pill {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.45rem 0.85rem;
            border-radius: 999px;
            background: var(--accent-light);
            border: 1px solid var(--border);
            color: var(--text);
            font-weight: 700;
            font-size: 0.85rem;
        }
        .select {
            padding: 0.65rem 0.9rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
            font-family: inherit;
            font-weight: 700;
            min-width: 320px;
        }
        .table-wrap { overflow: auto; }
        table.data {
            width: 100%;
            border-collapse: collapse;
            min-width: 520px;
        }
        table.data th {
            text-align: right;
            font-size: 0.85rem;
            color: var(--text-muted);
            background: var(--accent-light);
            padding: 0.75rem 0.7rem;
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }
        table.data td {
            padding: 0.7rem;
            border-bottom: 1px solid var(--border);
            font-weight: 700;
            color: var(--text);
            font-size: 0.92rem;
        }
        .muted { color: var(--text-muted); font-weight: 700; }
        .money { color: var(--accent); font-weight: 900; }
        .danger { color: var(--danger); font-weight: 900; }
        
        /* No-print class for screen-only elements */
        .no-print { }

        /* Print styles - OPTIMIZED FOR COMPACT & CLEAR OUTPUT */
        @media print {
            /* Reset & Base */
            * { 
                margin: 0 !important; 
                padding: 0 !important; 
                box-shadow: none !important; 
                border-radius: 0 !important;
                animation: none !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            body { 
                background: white !important; 
                color: #333 !important;
                font-size: 10pt !important; 
                font-family: 'Vazirmatn', Tahoma, sans-serif !important;
                padding: 8mm !important;
                line-height: 1.4 !important;
            }
            .container { max-width: 100% !important; }
            
            /* Hide non-essential elements */
            .btn, .btn-back, .btn-print { display: none !important; }
            .no-print { display: none !important; } /* Hide all no-print elements */
            .select { display: none !important; }
            
            /* ============ PRINT HEADER ============ */
            .page-header { 
                display: block !important;
                text-align: center !important;
                margin-bottom: 5mm !important; 
                padding-bottom: 3mm !important;
                border-bottom: 2px solid #333 !important;
            }
            .header-right { 
                display: block !important;
                justify-content: center !important;
            }
            .page-title { 
                font-size: 16pt !important;
                font-weight: 900 !important;
                color: #222 !important;
                display: block !important;
                margin-bottom: 2mm !important;
            }
            .shift-badge { 
                font-size: 11pt !important; 
                font-weight: 700 !important;
                padding: 2mm 4mm !important;
                border: 1px solid #666 !important;
                background: #f8f8f8 !important;
                color: #333 !important;
                display: inline-block !important;
            }
            
            /* ============ STATS GRID ============ */
            .stats-grid {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 3mm !important;
                margin-bottom: 5mm !important;
            }
            .stat-card {
                border: 1px solid #999 !important;
                padding: 3mm !important;
                min-height: auto !important;
                background: white !important;
                page-break-inside: avoid !important;
            }
            .stat-card::before { display: none !important; }
            .stat-header { 
                margin-bottom: 2mm !important; 
                gap: 2mm !important; 
            }
            .stat-icon { display: none !important; } /* Hide icons in print */
            .stat-title { 
                font-size: 9pt !important; 
                font-weight: 700 !important;
                color: #555 !important; 
                text-align: center !important;
            }
            .stat-value { 
                font-size: 14pt !important; 
                font-weight: 900 !important;
                color: #222 !important;
                margin-bottom: 1mm !important;
                text-align: center !important;
            }
            .stat-sub { 
                font-size: 8pt !important; 
                color: #666 !important;
                text-align: center !important;
            }
            .stat-sub strong { 
                color: #333 !important; 
                font-weight: 700 !important;
            }
            .stat-sub .danger { 
                color: #333 !important;
                font-weight: 900 !important;
            }
            
            /* ============ SECTION CARDS & TABLES ============ */
            .section-card {
                border: 1px solid #ccc !important;
                padding: 3mm !important;
                margin-bottom: 4mm !important;
                page-break-inside: avoid !important;
                background: white !important;
            }
            .section-title { 
                font-size: 11pt !important; 
                font-weight: 900 !important;
                color: #222 !important;
                margin-bottom: 3mm !important;
                text-align: center !important;
                border-bottom: 1px solid #999 !important;
                padding-bottom: 2mm !important;
            }
            .meta-badges { display: none !important; } /* Hide pills - redundant with table */
            .pill { display: none !important; }
            
            /* Tables */
            table.data { 
                width: 100% !important;
                min-width: auto !important; 
                font-size: 9pt !important;
                border-collapse: collapse !important;
            }
            table.data th {
                padding: 2.5mm !important;
                font-size: 9pt !important;
                font-weight: 700 !important;
                background: #f0f0f0 !important;
                border: 1px solid #999 !important;
                color: #333 !important;
                text-align: center !important;
            }
            table.data td {
                padding: 2mm !important;
                font-size: 9pt !important;
                font-weight: 600 !important;
                border: 1px solid #ccc !important;
                color: #333 !important;
                text-align: right !important;
            }
            .money { 
                color: #222 !important; 
                font-weight: 900 !important;
            }
            .danger { 
                color: #333 !important;
                font-weight: 900 !important;
            }
            .muted { 
                color: #777 !important; 
                font-weight: 600 !important;
                font-style: italic !important;
            }
            
            /* ============ FINANCIAL CARD ============ */
            .fin-card {
                border: 2px solid #666 !important;
                padding: 4mm !important;
                margin-bottom: 5mm !important;
                page-break-inside: avoid !important;
                background: #fafafa !important;
            }
            .fin-title { 
                font-size: 12pt !important; 
                font-weight: 900 !important;
                color: #222 !important;
                margin-bottom: 3mm !important;
                text-align: center !important;
                border-bottom: 1px solid #999 !important;
                padding-bottom: 2mm !important;
            }
            .fin-grid {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 3mm !important;
            }
            .fin-box { 
                padding: 3mm !important; 
                border: 1px solid #999 !important;
                background: white !important;
                text-align: center !important;
            }
            .fin-box-value { 
                font-size: 13pt !important; 
                font-weight: 900 !important;
                color: #222 !important;
                margin-bottom: 1mm !important;
            }
            .fin-box-label { 
                font-size: 8pt !important; 
                font-weight: 700 !important;
                color: #555 !important;
            }
            
            /* Page settings */
            @page {
                size: A4;
                margin: 10mm;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .stat-card, .fin-card, .time-card {
            animation: fadeIn 0.4s ease forwards;
        }
        .stat-card:nth-child(1) { animation-delay: 0.05s; }
        .stat-card:nth-child(2) { animation-delay: 0.1s; }
        .stat-card:nth-child(3) { animation-delay: 0.15s; }
        .stat-card:nth-child(4) { animation-delay: 0.2s; }
        .stat-card:nth-child(5) { animation-delay: 0.25s; }
        .stat-card:nth-child(6) { animation-delay: 0.3s; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="page-header">
            <div class="header-right">
                <h1 class="page-title">Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø´ÛŒÙØª</h1>
                <div class="shift-badge shift-{{ shift }}">
                    {% if shift == 'morning' %}â˜€ï¸{% elif shift == 'evening' %}ğŸŒ…{% else %}ğŸŒ™{% endif %}
                    {{ shift_fa }} | {{ jalali_date }} | {{ username }}
                </div>
            </div>
            <div style="display:flex; gap:0.5rem;">
                <button class="btn btn-print" onclick="window.print()">ğŸ–¨ï¸ Ú†Ø§Ù¾</button>
                <a href="{{ url_for('reception.index') }}" class="btn btn-back">â¬…ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª</a>
            </div>
        </div>

        <!-- Shift Picker (current + previous shifts of this reception) - HIDDEN IN PRINT -->
        <div class="section-card no-print">
            <div class="meta-row">
                <div class="meta-badges">
                    <div class="pill">ğŸ‘¤ {{ username }}</div>
                    <div class="pill">ğŸ“… {{ jalali_date }}</div>
                    <div class="pill">ğŸ•’ {{ shift_fa }}</div>
                </div>
                <div>
                    <label class="muted" for="shiftSelect">Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÛŒÙØªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Øª:</label>
                    <select id="shiftSelect" class="select">
                        {% for s in shifts_list %}
                            {% set is_sel = (s.work_date == selected_work_date and s.shift == selected_shift) %}
                            <option value="{{ s.work_date }}|{{ s.shift }}" {% if is_sel %}selected{% endif %}>
                                {{ s.jalali_date }} - Ø´ÛŒÙØª {{ s.shift_fa }}{% if s.is_current %} (ÙØ¹Ù„ÛŒ){% endif %}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <!-- Time Info - HIDDEN IN PRINT -->
        <div class="time-card no-print">
            <div class="time-item">
                <div class="time-label">Ø´Ø±ÙˆØ¹ Ø´ÛŒÙØª</div>
                <div class="time-value">{{ start_time }}</div>
            </div>
            <div class="time-item">
                <div class="time-label">Ù¾Ø§ÛŒØ§Ù† Ø´ÛŒÙØª</div>
                <div class="time-value">{{ end_time }}</div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card visits">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ‘¨â€âš•ï¸</div>
                    <div class="stat-title">ÙˆÛŒØ²ÛŒØª</div>
                </div>
                <div class="stat-value">{{ "{:,}".format((report.get('visits_total',0))|int) }}</div>
                <div class="stat-sub">Ù…Ø¹ÙˆÙ‚Ù‡: <strong class="danger">{{ "{:,}".format((report.get('visits_pending_total',0))|int) }}</strong></div>
            </div>

            <div class="stat-card injections">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ’‰</div>
                    <div class="stat-title">Ø®Ø¯Ù…Ø§Øª Ù¾Ø±Ø³ØªØ§Ø±ÛŒ</div>
                </div>
                <div class="stat-value">{{ "{:,}".format((report.get('nursing_total',0))|int) }}</div>
                <div class="stat-sub">Ù…Ø¹ÙˆÙ‚Ù‡: <strong class="danger">{{ "{:,}".format((report.get('nursing_pending_total',0))|int) }}</strong></div>
            </div>

            <div class="stat-card procedures">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ¥</div>
                    <div class="stat-title">Ú©Ø§Ø± Ø¹Ù…Ù„ÛŒ</div>
                </div>
                <div class="stat-value">{{ "{:,}".format((report.get('procedures_total',0))|int) }}</div>
                <div class="stat-sub">Ù…Ø¹ÙˆÙ‚: <strong class="danger">{{ "{:,}".format((report.get('procedures_pending_total',0))|int) }}</strong></div>
            </div>

            <div class="stat-card consumables">
                <div class="stat-header">
                    <div class="stat-icon">ï¿½</div>
                    <div class="stat-title">Ù…ØµØ±ÙÛŒ</div>
                </div>
                <div class="stat-value">{{ "{:,}".format((report.get('consumables_total',0))|int) }}</div>
                <div class="stat-sub">Ø§Ù‚Ù„Ø§Ù…: <strong>{{ (report.get('consumables_items',[])|length) }}</strong></div>
            </div>

            <div class="stat-card patients">
                <div class="stat-header">
                    <div class="stat-icon">ï¿½</div>
                    <div class="stat-title">Ø¯Ø§Ø±Ùˆ</div>
                </div>
                <div class="stat-value">{{ "{:,}".format((report.get('drugs_total',0))|int) }}</div>
                <div class="stat-sub">Ø§Ù‚Ù„Ø§Ù…: <strong>{{ (report.get('drugs_items',[])|length) }}</strong></div>
            </div>

            <div class="stat-card revenue">
                <div class="stat-header">
                    <div class="stat-icon">ğŸ“„</div>
                    <div class="stat-title">ÙØ§Ú©ØªÙˆØ±</div>
                </div>
                <div class="stat-value">{{ report.get('invoice_count',0) }}</div>
                <div class="stat-sub">Ø¨ÛŒÙ…Ø§Ø± ÛŒÚ©ØªØ§: <strong>{{ report.get('patient_count',0) }}</strong></div>
            </div>
        </div>

        <!-- Visits by insurance (ØªÙÚ©ÛŒÚ©) -->
        <div class="section-card">
            <div class="section-title">ÙˆÛŒØ²ÛŒØª Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ø¨ÛŒÙ…Ù‡</div>
            <div class="table-wrap">
                <table class="data">
                    <thead>
                        <tr>
                            <th>Ø¨ÛŒÙ…Ù‡</th>
                            <th>ØªØ¹Ø¯Ø§Ø¯</th>
                            <th>Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set rows = report.get('visits_by_insurance', []) %}
                        {% if rows and rows|length > 0 %}
                            {% for r in rows %}
                                <tr>
                                    <td>{{ r.insurance_type or 'Ù†Ø§Ù…Ø´Ø®Øµ' }}</td>
                                    <td>{{ r.count }}</td>
                                    <td class="money">{{ "{:,}".format((r.total|int)) }}</td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr><td colspan="3" class="muted">Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø´ÛŒÙØª Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Doctor injections amounts -->
        <div class="section-card">
            <div class="section-title">ØªØ²Ø±ÛŒÙ‚Ø§Øª Ù¾Ø²Ø´Ú©</div>
            <div class="table-wrap">
                <table class="data">
                    <thead>
                        <tr>
                            <th>Ù¾Ø²Ø´Ú©</th>
                            <th>ØªØ¹Ø¯Ø§Ø¯</th>
                            <th>Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set rows = report.get('injections_by_doctor', []) %}
                        {% if rows and rows|length > 0 %}
                            {% for r in rows %}
                                <tr>
                                    <td>{{ r.doctor_name }}</td>
                                    <td>{{ r.count }}</td>
                                    <td class="money">{{ "{:,}".format((r.total|int)) }}</td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr><td colspan="3" class="muted">ØªØ²Ø±ÛŒÙ‚ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø´ÛŒÙØª Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Consumables and Drugs quantity lists -->
        <div class="section-card">
            <div class="section-title">Ù…ØµØ±ÙÛŒâ€ŒÙ‡Ø§</div>
            <div class="table-wrap">
                <table class="data">
                    <thead>
                        <tr>
                            <th>Ø¢ÛŒØªÙ…</th>
                            <th>ØªØ¹Ø¯Ø§Ø¯</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set rows = report.get('consumables_items', []) %}
                        {% if rows and rows|length > 0 %}
                            {% for r in rows %}
                                <tr>
                                    <td>{{ r.item_name }}</td>
                                    <td>{{ r.total_qty }}</td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr><td colspan="2" class="muted">Ù…ØµØ±ÙÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section-card">
            <div class="section-title">Ø¯Ø§Ø±ÙˆÙ‡Ø§</div>
            <div class="table-wrap">
                <table class="data">
                    <thead>
                        <tr>
                            <th>Ø¢ÛŒØªÙ…</th>
                            <th>ØªØ¹Ø¯Ø§Ø¯</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set rows = report.get('drugs_items', []) %}
                        {% if rows and rows|length > 0 %}
                            {% for r in rows %}
                                <tr>
                                    <td>{{ r.item_name }}</td>
                                    <td>{{ r.total_qty }}</td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr><td colspan="2" class="muted">Ø¯Ø§Ø±ÙˆÛŒÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Financial Summary -->
        <div class="fin-card">
            <div class="fin-title">Ø®Ù„Ø§ØµÙ‡ Ù…Ø§Ù„ÛŒ</div>
            <div class="fin-grid">
                <div class="fin-box total">
                    <div class="fin-box-value">{{ "{:,}".format((report.get('total_revenue',0))|int) }}</div>
                    <div class="fin-box-label">Ø¬Ù…Ø¹ Ú©Ù„</div>
                </div>
                <div class="fin-box paid">
                    <div class="fin-box-value">{{ "{:,}".format((report.get('total_settled',0))|int) }}</div>
                    <div class="fin-box-label">ØªØ³ÙˆÛŒÙ‡ Ø´Ø¯Ù‡</div>
                </div>
                <div class="fin-box pending">
                    <div class="fin-box-value">{{ "{:,}".format((report.get('total_pending',0))|int) }}</div>
                    <div class="fin-box-label">Ù…Ø§Ù†Ø¯Ù‡</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load saved reception theme (use same key as other reception pages)
        (function(){
            const t = localStorage.getItem('receptionTheme') || 'light';
            if(t === 'dark') document.body.classList.add('theme-dark');
        })();

        // Shift picker: redirect with query params
        (function(){
            const el = document.getElementById('shiftSelect');
            if(!el) return;
            el.addEventListener('change', function(){
                const v = (this.value || '').split('|');
                if(v.length !== 2) return;
                const workDate = encodeURIComponent(v[0]);
                const shift = encodeURIComponent(v[1]);
                window.location.href = `{{ url_for('reception.shift_performance') }}?work_date=${workDate}&shift=${shift}`;
            });
        })();
    </script>
</body>
</html>
